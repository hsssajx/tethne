
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tethne.readers &mdash; tethne  documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="tethne  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">tethne  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for tethne.readers</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Each file reader takes an input file from an academic knowledge database</span>
<span class="sd">such as the Web of Science or PubMed and parses the input file into a</span>
<span class="sd">list of &quot;meta_dict&quot; dictionaries for each paper with as many as possible of </span>
<span class="sd">the following keys; missing values are set to None:</span>

<span class="sd">    * aulast  - authors&#39; last name as a list</span>
<span class="sd">    * auinit  - authors&#39; first initial as a list</span>
<span class="sd">    * atitle  - article title</span>
<span class="sd">    * jtitle  - journal title or abbreviated title</span>
<span class="sd">    * volume  - journal volume number</span>
<span class="sd">    * issue   - journal issue number</span>
<span class="sd">    * spage   - starting page of article in journal</span>
<span class="sd">    * epage   - ending page of article in journal</span>
<span class="sd">    * date    - article date of publication</span>
<span class="sd">    </span>
<span class="sd">These keys are associated with the meta data entries in the databases of</span>
<span class="sd">organizations such as the International DOI Foundation and its Registration</span>
<span class="sd">Agencies such as CrossRef and DataCite.</span>

<span class="sd">In addition, meta_dict dictionaries will contain keys with information </span>
<span class="sd">relevant to the networks of interest for Tethne including:</span>

<span class="sd">    * citations -- list of minimum meta_dict dictionaries for cited references.</span>
<span class="sd">    * ayjid -- First author&#39;s name (last, fi), publication year, and journal.</span>
<span class="sd">    * doi -- Digital Object Identifier</span>
<span class="sd">    * pmid -- PubMed ID</span>
<span class="sd">    * wosid -- Web of Science UT fieldtag</span>
<span class="sd">    </span>
<span class="sd">Missing data here also results in the above keys being set to None.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">data_struct</span> <span class="kn">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># general functions</span>

<div class="viewcode-block" id="create_ayjid"><a class="viewcode-back" href="../../tethne.html#tethne.readers.create_ayjid">[docs]</a><span class="k">def</span> <span class="nf">create_ayjid</span><span class="p">(</span><span class="n">aulast</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auinit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">jtitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert aulast, auinit, and jtitle into the fuzzy identifier ayjid</span>
<span class="sd">    Returns &#39;Unknown paper&#39; if all id components are missing (None).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Kwargs : dict</span>
<span class="sd">        A dictionary of keyword arguments.</span>
<span class="sd">    aulast : string</span>
<span class="sd">        Author surname.</span>
<span class="sd">    auinit: string</span>
<span class="sd">        Author initial(s).</span>
<span class="sd">    date : string</span>
<span class="sd">        Four-digit year.</span>
<span class="sd">    jtitle : string</span>
<span class="sd">        Title of the journal.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ayj : string</span>
<span class="sd">        Fuzzy identifier ayjid, or &#39;Unknown paper&#39; if all id components are </span>
<span class="sd">        missing (None).</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">aulast</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">aulast</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aulast</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">aulast</span> <span class="o">=</span> <span class="n">aulast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">auinit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">auinit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auinit</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">auinit</span> <span class="o">=</span> <span class="n">auinit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">jtitle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">jtitle</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="n">ayj</span> <span class="o">=</span> <span class="n">aulast</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">auinit</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">jtitle</span>

    <span class="k">if</span> <span class="n">ayj</span> <span class="o">==</span> <span class="s">&#39;   &#39;</span><span class="p">:</span>
        <span class="n">ayj</span> <span class="o">=</span> <span class="s">&#39;Unknown paper&#39;</span>

    <span class="k">return</span> <span class="n">ayj</span>
</div>
<div class="viewcode-block" id="create_ainstid"><a class="viewcode-back" href="../../tethne.html#tethne.readers.create_ainstid">[docs]</a><span class="k">def</span> <span class="nf">create_ainstid</span><span class="p">(</span><span class="n">aulast</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auinit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">addr1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">addr2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is to create an fuzzy identifier ainstid.</span>
<span class="sd">    Convert aulast, auinit, and jtitle into the fuzzy identifier ainstid.</span>
<span class="sd">    Returns &#39;Unknown Institution&#39; if all id components are missing (None).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Kwargs : dict</span>
<span class="sd">        A dictionary of keyword arguments.</span>
<span class="sd">    aulast : string</span>
<span class="sd">        Author surname.</span>
<span class="sd">    auinit : string</span>
<span class="sd">        Author initial(s).</span>
<span class="sd">    address1 : string</span>
<span class="sd">        Address of the Institution.</span>
<span class="sd">    address2 : string</span>
<span class="sd">        Address of the Institution.</span>
<span class="sd">    country : string</span>
<span class="sd">        Country of affiliation</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ainstid : string</span>
<span class="sd">        Fuzzy identifier ainstid, or &#39;Unknown Institution&#39; if all id components </span>
<span class="sd">        are missing (None).</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">aulast</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">aulast</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aulast</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">aulast</span> <span class="o">=</span> <span class="n">aulast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">auinit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">auinit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auinit</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">auinit</span> <span class="o">=</span> <span class="n">auinit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">addr1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">addr1</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">if</span>  <span class="n">addr2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">addr2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span>  <span class="n">country</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">country</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="n">ainstid</span> <span class="o">=</span> <span class="n">aulast</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">auinit</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">addr1</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">addr2</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">country</span> 

    <span class="k">if</span> <span class="n">ainstid</span> <span class="o">==</span> <span class="s">&#39; &#39;</span><span class="p">:</span>
        <span class="n">ainstid</span> <span class="o">=</span> <span class="s">&#39;Unknown Institution&#39;</span>

    <span class="k">return</span> <span class="n">ainstid</span>


<span class="c"># Web of Science functions</span></div>
<div class="viewcode-block" id="parse_wos"><a class="viewcode-back" href="../../tethne.html#tethne.readers.parse_wos">[docs]</a><span class="k">def</span> <span class="nf">parse_wos</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read Web of Science plain text data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : string</span>
<span class="sd">        Filepath to the Web of Science plain text file.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wos_list : list</span>
<span class="sd">        A list of dictionaries each associated with a paper from the Web of </span>
<span class="sd">        Science with keys from docs/fieldtags.txt as encountered in the file; </span>
<span class="sd">        most values associated with keys are strings with special exceptions </span>
<span class="sd">        defined by the list_keys and int_keys variables.</span>
<span class="sd">            </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyError</span>
<span class="sd">        One key value which needs to be converted to an &#39;int&#39; is not present.</span>
<span class="sd">    </span>
<span class="sd">    AttributeError</span>
<span class="sd">        similar type of error as given above.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Unknown keys: RI, OI, Z9</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wos_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">#define special key handling</span>
    <span class="n">paper_start_key</span> <span class="o">=</span> <span class="s">&#39;PT&#39;</span>
    <span class="n">paper_end_key</span> <span class="o">=</span> <span class="s">&#39;ER&#39;</span>
    <span class="k">print</span> <span class="s">&#39;comes in readers.parsewos - V5&#39;</span>
    <span class="c">#try to read filepath</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Unable to read filepath or filepath is empty&quot;</span><span class="p">)</span>

    <span class="c">#convert the data in the file to a usable list of dictionaries</span>
    <span class="c">#note: first two lines of file are not related to any paper therein</span>
    <span class="n">last_field_tag</span> <span class="o">=</span> <span class="n">paper_start_key</span> <span class="c">#initialize to something</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">field_tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_tag</span> <span class="o">==</span> <span class="n">paper_start_key</span><span class="p">:</span>
            <span class="c">#then prepare for next paper</span>
            <span class="n">wos_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_wos_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">field_tag</span> <span class="o">==</span> <span class="n">paper_end_key</span><span class="p">:</span>
            <span class="c">#then add paper to our list</span>
            <span class="n">wos_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wos_dict</span><span class="p">)</span>

        <span class="c">#handle keys like AU,AF,CR that continue over many lines</span>
        <span class="k">if</span> <span class="n">field_tag</span> <span class="o">==</span> <span class="s">&#39;  &#39;</span><span class="p">:</span>
            <span class="n">field_tag</span> <span class="o">=</span> <span class="n">last_field_tag</span>

        <span class="c">#add value for the key to the wos_dict: the rest of the line</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;AU&#39;</span><span class="p">,</span> <span class="s">&#39;AF&#39;</span><span class="p">,</span> <span class="s">&#39;CR&#39;</span><span class="p">,</span><span class="s">&#39;C1&#39;</span><span class="p">]:</span> 
                <span class="c">#these unique fields use the new line delimiter to distinguish</span>
                <span class="c">#their list elements below</span>
                <span class="c">#the field C1 can be either in multiple lines or in a single line- It is the address/institutions of the author.</span>
                <span class="n">wos_dict</span><span class="p">[</span><span class="n">field_tag</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wos_dict</span><span class="p">[</span><span class="n">field_tag</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="c">#key didn&#39;t exist already, can&#39;t append but must create</span>
            <span class="n">wos_dict</span><span class="p">[</span><span class="n">field_tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>

        <span class="n">last_field_tag</span> <span class="o">=</span> <span class="n">field_tag</span>
    <span class="c">#end line loop</span>

    <span class="c">#define keys that should be lists instead of default string</span>
    <span class="n">list_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;AU&#39;</span><span class="p">,</span><span class="s">&#39;AF&#39;</span><span class="p">,</span><span class="s">&#39;DE&#39;</span><span class="p">,</span><span class="s">&#39;ID&#39;</span><span class="p">,</span><span class="s">&#39;CR&#39;</span><span class="p">,</span><span class="s">&#39;C1&#39;</span><span class="p">]</span>
    <span class="n">delims</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;AU&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
              <span class="s">&#39;AF&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
              <span class="s">&#39;DE&#39;</span><span class="p">:</span><span class="s">&#39;;&#39;</span><span class="p">,</span>
              <span class="s">&#39;ID&#39;</span><span class="p">:</span><span class="s">&#39;;&#39;</span><span class="p">,</span>
              <span class="s">&#39;C1&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
              <span class="s">&#39;CR&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">}</span>
    
    <span class="c">#and convert the data at those keys into lists</span>
    <span class="k">for</span> <span class="n">wos_dict</span> <span class="ow">in</span> <span class="n">wos_list</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;wos_dict is </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">wos_dict</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">list_keys</span><span class="p">:</span>
            <span class="n">delim</span> <span class="o">=</span> <span class="n">delims</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;delim is</span><span class="se">\n</span><span class="s">&#39;</span> <span class="p">,</span> <span class="n">delim</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key_contents</span> <span class="o">=</span> <span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">print</span> <span class="s">&#39;key_contents is </span><span class="se">\n</span><span class="s"> &#39;</span> <span class="p">,</span> <span class="n">key_contents</span>
                <span class="k">if</span> <span class="n">delim</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
                    <span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c">#one of the keys to be converted to a list didn&#39;t exist</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c">#again a key didn&#39;t exist but it belonged to the wos</span>
                <span class="c">#data_struct set of keys; can&#39;t split a None</span>
                <span class="k">pass</span>
            
    <span class="c">#similarly convert some data from string to int</span>
    <span class="n">int_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PY&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">wos_dict</span> <span class="ow">in</span> <span class="n">wos_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">int_keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c">#one of the keys to be converted to an int didn&#39;t exist</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c">#again a key didn&#39;t exist but it belonged to the wos</span>
                <span class="c">#data_struct set of keys; can&#39;t convert None to an int</span>
                <span class="k">pass</span>
 
    <span class="k">return</span> <span class="n">wos_list</span>

</div>
<div class="viewcode-block" id="parse_cr"><a class="viewcode-back" href="../../tethne.html#tethne.readers.parse_cr">[docs]</a><span class="k">def</span> <span class="nf">parse_cr</span><span class="p">(</span><span class="n">ref</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Supports the Web of Science reader by converting the strings found</span>
<span class="sd">    at the CR field tag of a record into a minimum meta_dict dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref : str</span>
<span class="sd">        CR field tag data from a plain text Web of Science file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    meta_dict : dict</span>
<span class="sd">        meta_dict dictionary.</span>
<span class="sd">        </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    IndexError</span>
<span class="sd">        When input &#39;ref&#39; has less number of tokens than necessary ones.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Gets input with mismacthed inputtype. Ex: getting no numbers for a date </span>
<span class="sd">        field.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Needs a sophisticated name parser, would like to use an open source resource</span>
<span class="sd">    for this.</span>
<span class="sd">    </span>
<span class="sd">    If WoS is missing a field in the middle of the list there are NOT commas </span>
<span class="sd">    indicating that; the following example does NOT occur:</span>
<span class="sd">    </span>
<span class="sd">        Doe J, ,, Some Journal</span>

<span class="sd">    instead</span>

<span class="sd">        Doe J, Some Journal</span>

<span class="sd">    This threatens the integrity of WoS data; should we address it?</span>
<span class="sd">    </span>
<span class="sd">    Another threat: if WoS is unsure of the DOI number there will be multiple </span>
<span class="sd">    DOI numbers in a list of form [doi1, doi2, ...], address this?</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>
    <span class="c">#tokens of form: aulast auinit, date, jtitle, volume, spage, doi</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c">#FIXME: needs better name parser</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name_tokens</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c">#strip initial characters based on the field (spaces, &#39;V&#39;, &#39;DOI&#39;)</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;jtitle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;spage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">5</span><span class="p">:]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="c">#ref did not have the full set of tokens</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c">#this occurs when the program expects a date but gets a string with</span>
        <span class="c">#no numbers, we leave the field incomplete because chances are</span>
        <span class="c">#the CR string is too sparse to use anyway</span>
        <span class="k">pass</span>

    <span class="n">ayjid</span> <span class="o">=</span> <span class="n">create_ayjid</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">],</span> 
                         <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;jtitle&#39;</span><span class="p">])</span>
    <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;ayjid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ayjid</span>
 
    <span class="k">return</span> <span class="n">meta_dict</span>
</div>
<div class="viewcode-block" id="parse_institutions"><a class="viewcode-back" href="../../tethne.html#tethne.readers.parse_institutions">[docs]</a><span class="k">def</span> <span class="nf">parse_institutions</span><span class="p">(</span><span class="n">ref</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Supports the Web of Science reader by converting the strings found at the C1</span>
<span class="sd">    fieldtag of a record into a minimum meta_dict dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref : str</span>
<span class="sd">        &#39;C1&#39; field tag data from a plain text Web of Science file which contains</span>
<span class="sd">        Author First and Last names, Institution affiliated, and the </span>
<span class="sd">        location/city where they are affiliated to.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    addr_dict : dict</span>
<span class="sd">        A meta_dict dictionary.</span>
<span class="sd">        </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    IndexError</span>
<span class="sd">        When input &#39;ref&#39; has less number of tokens than necessary ones.</span>

<span class="sd">    ValueError</span>
<span class="sd">        Gets input with mismacthed inputtype. Ex: getting no numbers for a date </span>
<span class="sd">        field.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Needs to check many test cases to check various input types.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">addr_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>
    <span class="c">#tokens of form: </span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;tokens inside parse_institutions : </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">tokens</span>
    <span class="k">try</span><span class="p">:</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name_tokens</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c">#strip initial characters based on the field (spaces, &#39;V&#39;, &#39;DOI&#39;)</span>
        <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;addr2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;addr3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
       
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="c">#ref did not have the full set of tokens</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c">#this occurs when the program expects a date but gets a string with</span>
        <span class="c">#no numbers, we leave the field incomplete because chances are</span>
        <span class="c">#the CR string is too sparse to use anyway</span>
        <span class="k">pass</span>
    
    <span class="n">auinsid</span> <span class="o">=</span> <span class="n">create_ayjid</span><span class="p">(</span><span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">],</span> <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">],</span> 
                         <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;jtitle&#39;</span><span class="p">])</span>
    <span class="n">addr_dict</span><span class="p">[</span><span class="s">&#39;auinsid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auinsid</span>
    <span class="k">print</span> <span class="s">&#39;auinsid&#39;</span><span class="p">,</span> <span class="n">auinsid</span>
    <span class="k">return</span> <span class="n">addr_dict</span>
</div>
<div class="viewcode-block" id="wos2meta"><a class="viewcode-back" href="../../tethne.html#tethne.readers.wos2meta">[docs]</a><span class="k">def</span> <span class="nf">wos2meta</span><span class="p">(</span><span class="n">wos_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a dictionary or list of dictionaries with keys from the</span>
<span class="sd">    Web of Science field tags into a meta_dict dictionary or list of</span>
<span class="sd">    dictionaries, the standard for Tethne.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wos_data : list</span>
<span class="sd">        A list of wos_dict dictionaries with keys from the WoS field tags.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wos_meta : dict</span>
<span class="sd">        A list of meta_dict dictionaries.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Need to handle author name anomolies (case, blank spaces, etc.) that may </span>
<span class="sd">    make the same author appear to be two different authors in Networkx; this is</span>
<span class="sd">    important for any graph with authors as nodes.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#create a meta_dict for each wos_dict and append to this list</span>
    <span class="n">wos_meta</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">#handle dict inputs by converting to a 1-item list</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wos_data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">wos_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">wos_data</span><span class="p">]</span>

    <span class="c">#define the direct relationships between WoS fieldtags and meta_dict keys</span>
    <span class="n">translator</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">wos2meta_map</span><span class="p">()</span>
    
    <span class="c">#perform the key convertions</span>
    <span class="k">for</span> <span class="n">wos_dict</span> <span class="ow">in</span> <span class="n">wos_data</span><span class="p">:</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>

        <span class="c">#direct translations</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">translator</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="n">translator</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">wos_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c"># more complicated translations</span>
        <span class="c"># FIXME: not robust to all names, organziation authors, etc.</span>
        <span class="k">if</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;AU&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">aulast_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">auinit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;AU&#39;</span><span class="p">]:</span>
                <span class="n">name_tokens</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">aulast</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># 1 for &#39;aulast, aufirst&#39;</span>
                    <span class="n">auinit</span> <span class="o">=</span> <span class="n">name_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> 
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="c"># then no first initial character</span>
                    <span class="c"># preserve parallel name lists with empty string</span>
                    <span class="n">auinit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">aulast_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aulast</span><span class="p">)</span>
                <span class="n">auinit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auinit</span><span class="p">)</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aulast_list</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auinit_list</span>

        <span class="c">#construct ayjid</span>
        <span class="n">ayjid</span> <span class="o">=</span> <span class="n">create_ayjid</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">],</span> 
                             <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;jtitle&#39;</span><span class="p">])</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;ayjid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ayjid</span>

        <span class="c">#Parse the C1 Field and create a fuzzy identifier for author co-institutions</span>
        
        <span class="k">if</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">aulast_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">auinit_list</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c"># Need to put the &#39;[ ] &#39; wildcard match which is implemented in Ipython Notebook</span>
            
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]:</span>
                <span class="n">name_tokens</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;name_tokens in wos_meta </span><span class="se">\n</span><span class="s"> :&#39;</span> <span class="p">,</span> <span class="n">name_tokens</span> <span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> name :&#39;</span> <span class="p">,</span> <span class="n">name</span> 
                
                <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;\[(.*?)\]&#39;</span><span class="p">)</span>
                <span class="c">#match=p.findall(&quot;[Modis, Konstantinos] Natl Tech Univ Athens, Sch Min &amp; Met Engn, Athens, Greece.[Vatalis, Konstantinos I.] Technol Educ Inst Western Macedonia, Dept Geotechnol &amp; Environm Engn, Koila Kozani GREECE, Greece.&quot;)</span>
                <span class="n">match</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span> <span class="p">:</span> 
                    <span class="k">print</span> <span class="s">&quot;match  found&quot;</span><span class="p">,</span> <span class="n">match</span>
                    <span class="c">#auinit1 = match[1].upper().strip()</span>
                    <span class="c">#print &#39;auinit1&#39; , auinit1</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;match  not found&quot;</span><span class="p">,</span> <span class="n">match</span>    
<span class="c">#                 aulast = name_tokens[0].upper().strip()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># 1 for &#39;aulast, aufirst&#39;</span>
                    <span class="n">auinit1</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">print</span> <span class="s">&#39;auinit1&#39;</span> <span class="p">,</span> <span class="n">auinit1</span>
                    <span class="c">#auinit = name_tokens[1][1].upper().strip()</span>
                    <span class="c">#print auinit </span>
                    
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="c"># then no first initial character</span>
                    <span class="c"># preserve parallel name lists with empty string</span>
                    <span class="n">auinit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">aulast_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aulast</span><span class="p">)</span>
                <span class="n">auinit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auinit</span><span class="p">)</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aulast_list</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auinit_list</span>
                <span class="k">print</span> <span class="s">&quot;meta_dict is &quot;</span><span class="p">,</span> <span class="n">meta_dict</span>
            <span class="c">#construct a fuzzy identifier</span>
        <span class="n">affid</span> <span class="o">=</span> <span class="n">create_ayjid</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">],</span> 
                                    <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;jtitle&#39;</span><span class="p">])</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;affid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">affid</span>
        <span class="k">print</span> <span class="s">&quot;meta_dict is &quot;</span><span class="p">,</span> <span class="n">meta_dict</span>

        <span class="c">#convert CR references into meta_dict format</span>
        <span class="k">if</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">meta_cr_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]:</span>
                <span class="n">meta_cr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parse_cr</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>
                <span class="k">print</span> <span class="s">&#39;meta_cr_list&#39;</span> <span class="p">,</span> <span class="n">meta_cr_list</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;citations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_cr_list</span>
            
        <span class="c">#convert C1 references into meta_dict format</span>
        <span class="k">if</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">meta_addr_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">wos_dict</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]:</span>
                <span class="k">print</span> <span class="s">&quot;411 &quot;</span> <span class="p">,</span> <span class="n">ref</span>
                <span class="n">meta_addr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parse_institutions</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_addr_list</span>    
            

        <span class="n">wos_meta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>
    <span class="c">#end wos_dict for loop</span>

    <span class="k">return</span> <span class="n">wos_meta</span>


<span class="c"># PubMed functions</span></div>
<div class="viewcode-block" id="pubmed_file_id"><a class="viewcode-back" href="../../tethne.html#tethne.readers.pubmed_file_id">[docs]</a><span class="k">def</span> <span class="nf">pubmed_file_id</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Future (not implemented).</span>
<span class="sd">    </span>
<span class="sd">    Given a filename (presumed to contain PubMed compatible IDs)</span>
<span class="sd">    return an xml string for each article associated with that ID.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string</span>
<span class="sd">        Path to a file containing PubMed-compatible IDs.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list : list</span>
<span class="sd">        A list of XML strings.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="parse_pubmed_xml"><a class="viewcode-back" href="../../tethne.html#tethne.readers.parse_pubmed_xml">[docs]</a><span class="k">def</span> <span class="nf">parse_pubmed_xml</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a file with PubMed XML, return a list of meta_dicts</span>
<span class="sd">    </span>
<span class="sd">    See the following hyperlinks regarding possible structures of XML:</span>
<span class="sd">    * http://www.ncbi.nlm.nih.gov/pmc/pmcdoc/tagging-guidelines/citations/v2/citationtags.html#2Articlewithmorethan10authors%28listthefirst10andaddetal%29</span>
<span class="sd">    * http://dtd.nlm.nih.gov/publishing/</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : string</span>
<span class="sd">        Path to PubMed XML file.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    meta_list : list</span>
<span class="sd">        A list of meta_dict dictionaries.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    
    <span class="c"># define location of simple article meta data relative to xml tree rooted </span>
    <span class="c"># at &#39;article&#39;</span>
    <span class="n">meta_loc</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;atitle&#39;</span><span class="p">:</span><span class="s">&#39;./front/article-meta/title-group/article-title&#39;</span><span class="p">,</span>
                <span class="s">&#39;jtitle&#39;</span><span class="p">:(</span><span class="s">&#39;./front/journal-meta/journal-title-group/&#39;</span> <span class="o">+</span>
                          <span class="s">&#39;journal-title&#39;</span><span class="p">),</span>
                <span class="s">&#39;volume&#39;</span><span class="p">:</span><span class="s">&#39;./front/article-meta/volume&#39;</span><span class="p">,</span>
                <span class="s">&#39;issue&#39;</span><span class="p">:</span><span class="s">&#39;./front/article-meta/issue&#39;</span><span class="p">,</span>
                <span class="s">&#39;spage&#39;</span><span class="p">:</span><span class="s">&#39;./front/article-meta/fpage&#39;</span><span class="p">,</span>
                <span class="s">&#39;epage&#39;</span><span class="p">:</span><span class="s">&#39;./front/article-meta/lpage&#39;</span><span class="p">}</span>
    
    <span class="c"># location relative to element-citation element</span>
    <span class="n">cit_meta_loc</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;atitle&#39;</span><span class="p">:</span><span class="s">&#39;./article-title&#39;</span><span class="p">,</span>
                    <span class="s">&#39;jtitle&#39;</span><span class="p">:</span><span class="s">&#39;./source&#39;</span><span class="p">,</span>
                    <span class="s">&#39;date&#39;</span><span class="p">:</span><span class="s">&#39;./year&#39;</span><span class="p">,</span>
                    <span class="s">&#39;volume&#39;</span><span class="p">:</span><span class="s">&#39;./volume&#39;</span><span class="p">,</span>
                    <span class="s">&#39;spage&#39;</span><span class="p">:</span><span class="s">&#39;./fpage&#39;</span><span class="p">,</span>
                    <span class="s">&#39;epage&#39;</span><span class="p">:</span><span class="s">&#39;./epage&#39;</span><span class="p">}</span>
    
    <span class="n">meta_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s">&#39;article&#39;</span><span class="p">):</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>
    
        <span class="c"># collect information from the &#39;front&#39; section of the article</span>
        <span class="c"># collect the simple data</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">meta_loc</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="n">key_data</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">meta_loc</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> 
            <span class="k">if</span> <span class="n">key_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_data</span><span class="o">.</span><span class="n">text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    
        <span class="c"># collect doi and pmid </span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./front/article-meta/article-id&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="n">id_type</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pub-id-type&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s">&#39;doi&#39;</span><span class="p">:</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">text</span> 
            <span class="k">elif</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s">&#39;pmid&#39;</span><span class="p">:</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;pmid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># if never found, remain at None from initialization</span>
                <span class="k">pass</span>
    
        <span class="c"># collect aulast and auinint</span>
        <span class="n">aulast</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">auinit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">contribs</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./front/article-meta/contrib-group/contrib&#39;</span><span class="p">)</span>
        <span class="c"># if contrib is not found then loop is skipped</span>
        <span class="k">for</span> <span class="n">contrib</span> <span class="ow">in</span> <span class="n">contribs</span><span class="p">:</span>
            <span class="n">contrib_type</span> <span class="o">=</span> <span class="n">contrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;contrib-type&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">contrib_type</span> <span class="o">==</span> <span class="s">&#39;author&#39;</span><span class="p">:</span>
                <span class="n">surname</span> <span class="o">=</span> <span class="n">contrib</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./name/surname&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">surname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># then it was found</span>
                    <span class="n">aulast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surname</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aulast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    
                <span class="c"># multiple given names? this takes first one</span>
                <span class="n">given_name</span> <span class="o">=</span> <span class="n">contrib</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./name/given-names&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">given_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># then it was found</span>
                    <span class="n">auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">given_name</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aulast</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auinit</span>
    
        <span class="c"># collect date</span>
        <span class="n">pub_dates</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./front/article-meta/pub-date&#39;</span><span class="p">)</span>
        <span class="c"># if pub-date is not found then loop is skipped</span>
        <span class="k">for</span> <span class="n">pub_date</span> <span class="ow">in</span> <span class="n">pub_dates</span><span class="p">:</span>
           <span class="n">pub_type</span> <span class="o">=</span> <span class="n">pub_date</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pub-type&#39;</span><span class="p">)</span> 
           <span class="k">print</span> <span class="n">pub_type</span>
           <span class="k">if</span> <span class="n">pub_type</span> <span class="o">==</span> <span class="s">&#39;collection&#39;</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="n">pub_date</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./year&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># then it was found</span>
                    <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    
        <span class="n">meta_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>
    
        <span class="c"># construct ayjid</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;ayjid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">create_ayjid</span><span class="p">(</span><span class="o">**</span><span class="n">meta_dict</span><span class="p">)</span>
    
        <span class="c"># citations</span>
        <span class="n">citations_list</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="c"># element-citation handling different from mixed-citation handling</span>
        <span class="n">citations</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./back/ref-list/ref/element-citation&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cite</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">:</span>
            <span class="n">cite_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>
            
            <span class="c"># simple meta data</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cit_meta_loc</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="n">key_data</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">cit_meta_loc</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> 
                <span class="k">if</span> <span class="n">key_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">meta_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_data</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">meta_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    
            <span class="c"># doi and pmid</span>
            <span class="n">pub_id</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./pub-id&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pub_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pub_id_type</span> <span class="o">=</span> <span class="n">pub_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pub-id-type&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pub_id_type</span> <span class="o">==</span> <span class="s">&#39;doi&#39;</span><span class="p">:</span>
                    <span class="n">cite_dict</span><span class="p">[</span><span class="s">&#39;doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pub_id</span><span class="o">.</span><span class="n">text</span>
                <span class="k">elif</span> <span class="n">pub_id_type</span> <span class="o">==</span> <span class="s">&#39;pmid&#39;</span><span class="p">:</span>
                    <span class="n">cite_dict</span><span class="p">[</span><span class="s">&#39;pmid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pub_id</span><span class="o">.</span><span class="n">text</span>
    
            <span class="c"># aulast and auinit</span>
            <span class="n">cite_aulast</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cite_auinit</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c"># determine if person group is authors</span>
            <span class="n">person_group</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./person-group&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">person_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">group_type</span> <span class="o">=</span> <span class="n">person_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;person-group-type&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_type</span> <span class="o">=</span> <span class="bp">None</span>
    
            <span class="c"># then add the authors to the cite_dict</span>
            <span class="k">if</span> <span class="n">group_type</span> <span class="o">==</span> <span class="s">&#39;author&#39;</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">person_group</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./name&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="c"># add surname</span>
                    <span class="n">surname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./surname&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">surname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c"># then it was found</span>
                        <span class="n">cite_aulast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surname</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cite_aulast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    
                    <span class="c"># add given names</span>
                    <span class="n">given_names</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;./given-names&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">given_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c"># then it was found</span>
                        <span class="n">cite_auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">given_names</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cite_auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cite_aulast</span><span class="p">:</span>
                <span class="c"># then empty</span>
                <span class="n">cite_aulast</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cite_auinit</span><span class="p">:</span>
                <span class="c"># then empty</span>
                <span class="n">cite_auinit</span> <span class="o">=</span> <span class="bp">None</span>
    
            <span class="n">cite_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite_aulast</span>
            <span class="n">cite_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite_auinit</span>
    
            <span class="n">citations_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cite_dict</span><span class="p">)</span>
        <span class="c"># end cite loop</span>
    
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;citations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">citations_list</span>
    
        <span class="n">meta_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>
    <span class="c"># end article loop</span>
    
    <span class="k">return</span> <span class="n">meta_list</span>
</div>
<div class="viewcode-block" id="expand_pubmed"><a class="viewcode-back" href="../../tethne.html#tethne.readers.expand_pubmed">[docs]</a><span class="k">def</span> <span class="nf">expand_pubmed</span><span class="p">(</span><span class="n">meta_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Future (not implemented).</span>
<span class="sd">    </span>
<span class="sd">    Given a list of first-level meta dicts and their second-level meta dicts,</span>
<span class="sd">    first[&#39;citations&#39;], expand the network by adding the second-level meta</span>
<span class="sd">    dicts to the first level. That is, for the second-level meta dicts with</span>
<span class="sd">    sufficient information (either a DOI, PubMed ID, enough metadata to</span>
<span class="sd">    query for a DOI, etc.), query PubMed for their more expansive set </span>
<span class="sd">    of meta data, most notably their citation data, parse the associated xml, </span>
<span class="sd">    and append their meta_dicts to the meta_list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    meta_list : list</span>
<span class="sd">        A list of meta_dict dictionaries.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list : list</span>
<span class="sd">        A list of meta_dict dictionaries.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Do something about the redundent information about them stored still in the </span>
<span class="sd">    first level?</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="parse_bib"><a class="viewcode-back" href="../../tethne.html#tethne.readers.parse_bib">[docs]</a><span class="k">def</span> <span class="nf">parse_bib</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string</span>
<span class="sd">        Path to BibTex file.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bib_list : list</span>
<span class="sd">        A list of meta_dict dictionaries.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    tethne.resources. bib has been known to make errors in parsing bib files.</span>

<span class="sd">    FIXME: structure the bibtex translator in the data_struct folder along with </span>
<span class="sd">    the others.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">tethne.resources.bib</span> <span class="kn">as</span> <span class="nn">bb</span>

    <span class="c">#load file into bib.py readable format</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="c">#parse the bibtex file into a dict (article) of dicts (article meta)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">clear_comments</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bib</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">Bibparser</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bib</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

    <span class="c">#convert data into a list of tethne meta_dict</span>
    <span class="n">translator</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;doi&#39;</span><span class="p">:</span><span class="s">&#39;doi&#39;</span><span class="p">,</span>
                  <span class="s">&#39;author&#39;</span><span class="p">:</span><span class="s">&#39;aulast&#39;</span><span class="p">,</span>
                  <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;atitle&#39;</span><span class="p">,</span>
                  <span class="s">&#39;journal&#39;</span><span class="p">:</span><span class="s">&#39;jtitle&#39;</span><span class="p">,</span>
                  <span class="s">&#39;volume&#39;</span><span class="p">:</span><span class="s">&#39;volume&#39;</span><span class="p">,</span>
                  <span class="s">&#39;year&#39;</span><span class="p">:</span><span class="s">&#39;date&#39;</span><span class="p">}</span>
    <span class="n">bib_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">bib</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">new_meta_dict</span><span class="p">()</span>
        <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">translator_keys</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">translator_keys</span><span class="p">:</span>
                <span class="n">meta_key</span> <span class="o">=</span> <span class="n">translator</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">meta_dict</span><span class="p">[</span><span class="n">meta_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">bib_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>

    <span class="c">#perform the non-simple convertions</span>
    <span class="k">for</span> <span class="n">meta_dict</span> <span class="ow">in</span> <span class="n">bib_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">aulast</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">auinit</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name_dict</span> <span class="ow">in</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]:</span>
                <span class="n">aulast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_dict</span><span class="p">[</span><span class="s">&#39;family&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;given&#39;</span> <span class="ow">in</span> <span class="n">name_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_dict</span><span class="p">[</span><span class="s">&#39;given&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">auinit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aulast</span>
            <span class="n">meta_dict</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auinit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Parser failed at&#39;</span><span class="p">,</span> <span class="n">meta_dict</span>

    <span class="k">return</span> <span class="n">bib_list</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">tethne  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, ASU Digital Innovation Group.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>