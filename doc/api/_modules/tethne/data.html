
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tethne.data &mdash; tethne 0.3.1-alpha documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="tethne 0.3.1-alpha documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">tethne 0.3.1-alpha documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for tethne.data</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes for handling bibliographic data.</span>

<span class="sd">.. autosummary::</span>

<span class="sd">   Paper</span>
<span class="sd">   DataCollection</span>
<span class="sd">   GraphCollection</span>
<span class="sd">   LDAModel</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">pickle</span> <span class="kn">as</span> <span class="nn">pk</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="Paper"><a class="viewcode-back" href="../../tethne.html#tethne.data.Paper">[docs]</a><span class="k">class</span> <span class="nc">Paper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for Papers. </span>
<span class="sd">    </span>
<span class="sd">    Behaves just like a dict, but enforces a limited vocabulary of keys, and </span>
<span class="sd">    specific data types.</span>

<span class="sd">    The following fields (and corresponding data types) are allowed:</span>
<span class="sd">    </span>
<span class="sd">    ===========     =====   ====================================================</span>
<span class="sd">    Field           Type    Description</span>
<span class="sd">    ===========     =====   ====================================================</span>
<span class="sd">    aulast          list    Authors&#39; last name, as a list.</span>
<span class="sd">    auinit          list    Authors&#39; first initial as a list.</span>
<span class="sd">    institution     dict    Institutions with which the authors are affiliated.</span>
<span class="sd">    atitle          str     Article title.</span>
<span class="sd">    jtitle          str     Journal title or abbreviated title.</span>
<span class="sd">    volume          str     Journal volume number.</span>
<span class="sd">    issue           str     Journal issue number.</span>
<span class="sd">    spage           str     Starting page of article in journal.</span>
<span class="sd">    epage           str     Ending page of article in journal.</span>
<span class="sd">    date            int     Article date of publication.</span>
<span class="sd">    country         dict    Author-Country mapping.</span>
<span class="sd">    citations       list    A list of :class:`.Paper` instances.</span>
<span class="sd">    ayjid           str     First author&#39;s name (last fi), pubdate, and journal.</span>
<span class="sd">    doi             str     Digital Object Identifier.</span>
<span class="sd">    pmid            str     PubMed ID.</span>
<span class="sd">    wosid           str     Web of Science UT fieldtag value.</span>
<span class="sd">    accession       str     Identifier for data conversion accession.</span>
<span class="sd">    ===========     =====   ====================================================</span>

<span class="sd">    None values are also allowed for all fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines keys, and acceptable data types for values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;aulast&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;auinit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;institutions&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;atitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;jtitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;volume&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;issue&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;spage&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;epage&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;date&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;citations&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;country&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;ayjid&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;doi&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;pmid&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;wosid&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;abstract&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;accession&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                            <span class="s">&#39;topics&#39;</span><span class="p">:</span><span class="bp">None</span>    <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;aulast&#39;</span><span class="p">,</span>
                             <span class="s">&#39;auinit&#39;</span><span class="p">,</span>
                             <span class="s">&#39;citations&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">string_fields</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;atitle&#39;</span><span class="p">,</span>
                               <span class="s">&#39;jtitle&#39;</span><span class="p">,</span>
                               <span class="s">&#39;volume&#39;</span><span class="p">,</span>
                               <span class="s">&#39;issue&#39;</span><span class="p">,</span>
                               <span class="s">&#39;spage&#39;</span><span class="p">,</span>
                               <span class="s">&#39;epage&#39;</span><span class="p">,</span>
                               <span class="s">&#39;ayjid&#39;</span><span class="p">,</span>
                               <span class="s">&#39;doi&#39;</span><span class="p">,</span>
                               <span class="s">&#39;pmid&#39;</span><span class="p">,</span>
                               <span class="s">&#39;wosid&#39;</span><span class="p">,</span>
                               <span class="s">&#39;abstract&#39;</span><span class="p">,</span>
                               <span class="s">&#39;accession&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">int_fields</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;date&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_fields</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;institutions&#39;</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces limited vocabulary of keys, and acceptable data types for</span>
<span class="sd">        values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vt</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">ks</span> <span class="o">+</span> <span class="s">&quot; is not a valid key in Paper.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_fields</span> <span class="ow">and</span> <span class="n">vt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Value for field &#39;&quot;</span><span class="o">+</span> <span class="n">ks</span> <span class="o">+</span><span class="s">&quot;&#39; must be a list.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_fields</span> <span class="ow">and</span> <span class="n">vt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Value for field &#39;&quot;</span><span class="o">+</span> <span class="n">ks</span> <span class="o">+</span><span class="s">&quot;&#39; must be a string.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_fields</span> <span class="ow">and</span> <span class="n">vt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Value for field &#39;&quot;</span><span class="o">+</span> <span class="n">ks</span> <span class="o">+</span><span class="s">&quot;&#39; must be an integer.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_fields</span> <span class="ow">and</span> <span class="n">vt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Value for field &#39;&quot;</span><span class="o">+</span> <span class="n">ks</span> <span class="o">+</span><span class="s">&quot;&#39; must be a dictionary.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">)</span>

<div class="viewcode-block" id="Paper.keys"><a class="viewcode-back" href="../../tethne.html#tethne.data.Paper.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the keys of the :class:`.Paper`&#39;s metadata fields.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Paper.values"><a class="viewcode-back" href="../../tethne.html#tethne.data.Paper.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the values of the :class:`.Paper`&#39;s metadata fields.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Paper.iteritems"><a class="viewcode-back" href="../../tethne.html#tethne.data.Paper.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an iterator for the :class:`.Paper`&#39;s metadata fields&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="Paper.authors"><a class="viewcode-back" href="../../tethne.html#tethne.data.Paper.authors">[docs]</a>    <span class="k">def</span> <span class="nf">authors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of author names (FI LAST).&quot;&quot;&quot;</span>
        
        <span class="n">auths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">])):</span>
            <span class="n">au</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="s">&#39;auinit&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">[</span><span class="s">&#39;aulast&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">auths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">au</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">auths</span>
</div></div>
<div class="viewcode-block" id="DataCollection"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection">[docs]</a><span class="k">class</span> <span class="nc">DataCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`.DataCollection` organizes :class:`.Paper`\s for analysis.</span>
<span class="sd">    </span>
<span class="sd">    The :class:`.DataCollection` is initialized with some data, which is indexed</span>
<span class="sd">    by a key in :class:`.Paper` (default is wosid). The :class:`.DataCollection`</span>
<span class="sd">    can then be sliced ( :func:`DataCollection.slice` ) by other keys in</span>
<span class="sd">    :class:`.Paper` .</span>
<span class="sd">    </span>
<span class="sd">    **Usage**</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; import tethne.readers as rd</span>
<span class="sd">       &gt;&gt;&gt; data = rd.wos.read(&quot;/Path/to/wos/data.txt&quot;)</span>
<span class="sd">       &gt;&gt;&gt; data += rd.wos.read(&quot;/Path/to/wos/data2.txt&quot;)    # Two accessions.</span>
<span class="sd">       &gt;&gt;&gt; from tethne.data import DataCollection</span>
<span class="sd">       &gt;&gt;&gt; D = DataCollection(data) # Indexed by wosid, by default.</span>
<span class="sd">       &gt;&gt;&gt; D.slice(&#39;date&#39;, &#39;time_window&#39;, window_size=4)</span>
<span class="sd">       &gt;&gt;&gt; D.slice(&#39;accession&#39;)</span>
<span class="sd">       &gt;&gt;&gt; D</span>
<span class="sd">       &lt;tethne.data.DataCollection at 0x10af0ef50&gt;</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index_by</span><span class="o">=</span><span class="s">&#39;wosid&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_by</span> <span class="o">=</span> <span class="n">index_by</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datakeys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Paper</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Data must contain tethne.data.Paper objects.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">index_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datakeys</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index_by</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not a valid key in data.&quot;</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="n">p</span><span class="p">[</span><span class="n">index_by</span><span class="p">]:</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">}</span>
    
<div class="viewcode-block" id="DataCollection.slice"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.slice">[docs]</a>    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slices data by key, using method (if applicable).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            key in :class:`.Paper` by which to slice data.</span>
<span class="sd">        method : str (optional)</span>
<span class="sd">            Dictates how data should be sliced. See table for available methods.</span>
<span class="sd">            If key is &#39;date&#39;, default method is time_period with window_size and</span>
<span class="sd">            step_size of 1.</span>
<span class="sd">        kwargs : kwargs</span>
<span class="sd">            See methods table, below.</span>
<span class="sd">            </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Methods available for slicing DataCollections:</span>

<span class="sd">        ===========    =============================    =======    =============</span>
<span class="sd">        Method         Description                      Key        kwargs</span>
<span class="sd">        ===========    =============================    =======    =============</span>
<span class="sd">        time_window    Slices data using a sliding      date       window_size</span>
<span class="sd">                       time-window. Dataslices are                 step_size</span>
<span class="sd">                       indexed by the start of the </span>
<span class="sd">                       time-window.</span>
<span class="sd">        time_period    Slices data into time periods    date       window_size</span>
<span class="sd">                       of equal length. Dataslices</span>
<span class="sd">                       are indexed by the start of</span>
<span class="sd">                       the time period.</span>
<span class="sd">        ===========    =============================    =======    =============</span>

<span class="sd">        Avilable kwargs:</span>

<span class="sd">        ===========    ======   ================================================</span>
<span class="sd">        Argument       Type     Description</span>
<span class="sd">        ===========    ======   ================================================</span>
<span class="sd">        window_size    int      Size of time-window or period, in years</span>
<span class="sd">                                (default = 1).</span>
<span class="sd">        step_size      int      Amount to advance time-window or period in each</span>
<span class="sd">                                step (ignored for time_period).</span>
<span class="sd">        cumulative     bool     If True, the data from each successive slice </span>
<span class="sd">                                includes the data from all preceding slices.</span>
<span class="sd">                                Only applies if key is &#39;date&#39; (default = False).</span>
<span class="sd">        ===========    ======   ================================================            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;date&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;time_window&#39;</span><span class="p">:</span>
                <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>  <span class="s">&#39;window_size&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;window_size&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="s">&#39;step_size&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_slice</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;time_period&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>  <span class="s">&#39;window_size&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;window_size&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="s">&#39;step_size&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;window_size&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="s">&#39;cumulative&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cumulative&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="p">}</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_slice</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not a valid slicing method.&quot;</span><span class="p">))</span>
            
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;author&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">authors</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datakeys</span><span class="p">:</span> <span class="c"># e.g. &#39;jtitle&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not a valid key in data.&quot;</span><span class="p">))</span>
        </div>
    <span class="k">def</span> <span class="nf">_time_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slices data by date.</span>

<span class="sd">        If step_size = 1, this is a sliding time-window. If step_size =</span>
<span class="sd">        window_size, this is a time period slice.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs : kwargs</span>
<span class="sd">            See table, below.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        slices : dict</span>
<span class="sd">            Keys are start date of time slice, values are :class:`.Paper`</span>
<span class="sd">            indices (controlled by index_by argument in </span>
<span class="sd">            :func:`.DataCollection.__init__` )</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        </span>
<span class="sd">        Avilable kwargs:</span>

<span class="sd">        ===========    ======   ================================================</span>
<span class="sd">        Argument       Type     Description</span>
<span class="sd">        ===========    ======   ================================================</span>
<span class="sd">        window_size    int      Size of time-window or period, in years</span>
<span class="sd">                                (default = 1).</span>
<span class="sd">        step_size      int      Amount to advance time-window or period in each</span>
<span class="sd">                                step (ignored for time_period).</span>
<span class="sd">        cumulative     bool     If True, the data from each successive slice </span>
<span class="sd">                                includes the data from all preceding slices.</span>
<span class="sd">                                Only applies if key is &#39;date&#39; (default = False).                                </span>
<span class="sd">        ===========    ======   ================================================           </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">window_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;window_size&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">step_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;step_size&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="p">([</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> 
                                                 <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">]))</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> 
                                                 <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">]))</span>
        <span class="n">cumulative</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cumulative&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="n">slices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">window_size</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">step_size</span><span class="p">):</span>
            <span class="n">slices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> 
                           <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">window_size</span> <span class="p">]</span>
            <span class="k">if</span> <span class="n">cumulative</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">slices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">slices</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">return</span> <span class="n">slices</span>
        
<div class="viewcode-block" id="DataCollection.indices"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.indices">[docs]</a>    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a list of indices of all papers in this :class:`.DataCollection`</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="DataCollection.papers"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.papers">[docs]</a>    <span class="k">def</span> <span class="nf">papers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yield the complete set of :class:`.Paper` instances in this</span>
<span class="sd">        :class:`.DataCollection` .</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        papers : list</span>
<span class="sd">            A list of :class:`.Paper`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="DataCollection.get_slices"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.get_slices">[docs]</a>    <span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">papers</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields slices for key.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Key from :class:`.Paper` that has previously been used to slice data</span>
<span class="sd">            in this :class:`.DataCollection` .</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        slices : dict</span>
<span class="sd">            Keys are slice indices. If papers is True, values are lists of</span>
<span class="sd">            :class:`.Paper` instances; otherwise returns paper indices (e.g.</span>
<span class="sd">            &#39;wosid&#39;).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError : DataCollection has not been sliced.</span>
<span class="sd">        KeyError : Data has not been sliced by [key] </span>
<span class="sd">                    </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;DataCollection has not been sliced.&quot;</span><span class="p">))</span>        
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Data has not been sliced by &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        
        <span class="n">slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
         
        <span class="k">if</span> <span class="n">papers</span><span class="p">:</span>  <span class="c"># Retrieve Papers.</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">slices</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">slices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span> <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">slices</span>
</div>
<div class="viewcode-block" id="DataCollection.get_slice"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.get_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">papers</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a specific slice.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Key from :class:`.Paper` that has previously been used to slice data</span>
<span class="sd">            in this :class:`.DataCollection` .</span>
<span class="sd">        index : str or int</span>
<span class="sd">            Slice index for key (e.g. 1999 for &#39;date&#39;).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        slice : list</span>
<span class="sd">            List of paper indices in this :class:`.DataCollection` , or (if</span>
<span class="sd">            papers is True) a list of :class:`.Paper` instances.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError : DataCollection has not been sliced.</span>
<span class="sd">        KeyError : Data has not been sliced by [key] </span>
<span class="sd">        KeyError : [index] not a valid index for [key]</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;DataCollection has not been sliced.&quot;</span><span class="p">))</span>        
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Data has not been sliced by &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not a valid index for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        
        <span class="nb">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">papers</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">slice</span> <span class="p">]</span>
        <span class="k">return</span> <span class="nb">slice</span>
    </div>
<div class="viewcode-block" id="DataCollection.get_by"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.get_by">[docs]</a>    <span class="k">def</span> <span class="nf">get_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_indices</span><span class="p">,</span> <span class="n">papers</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a set of (key, index) tuples, return the corresponding subset of</span>
<span class="sd">        :class:`.Paper` indices (or :class:`.Paper` instances themselves, if </span>
<span class="sd">        papers is True).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_indices : list</span>
<span class="sd">            A list of (key, index) tuples.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plist : list</span>
<span class="sd">            A list of paper indices, or :class:`.Paper` instances.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError : DataCollection has not been sliced.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;DataCollection has not been sliced.&quot;</span><span class="p">))</span>
        
        <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="n">key_indices</span><span class="p">:</span>
            <span class="nb">slice</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
            <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>

        <span class="n">plist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">slices</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">papers</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">plist</span> <span class="p">]</span>
        <span class="k">return</span> <span class="n">plist</span>
    </div>
    <span class="k">def</span> <span class="nf">_get_slice_i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">_get_by_i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_indices</span><span class="p">):</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key_indices</span><span class="p">:</span>
            <span class="nb">slice</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_slice_i</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">slices</span><span class="p">)</span> <span class="p">)</span>
    
<div class="viewcode-block" id="DataCollection.get_axes"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.get_axes">[docs]</a>    <span class="k">def</span> <span class="nf">get_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all slice axes for this :class:`.DataCollection` .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="DataCollection.N_axes"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.N_axes">[docs]</a>    <span class="k">def</span> <span class="nf">N_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of slice axes for this :class:`.DataCollection` .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    </div>
<div class="viewcode-block" id="DataCollection.distribution"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.distribution">[docs]</a>    <span class="k">def</span> <span class="nf">distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Numpy array describing the number of :class:`.Paper`</span>
<span class="sd">        associated with each slice-coordinate.</span>
<span class="sd">        </span>
<span class="sd">        WARNING: expensive for a :class:`.DataCollection` with many axes or</span>
<span class="sd">        long axes. Consider using :func:`.distribution_2d` .</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist : Numpy array</span>
<span class="sd">            An N-dimensional array. Axes are given by </span>
<span class="sd">            :func:`DataCollection.get_axes` and values are the number of</span>
<span class="sd">            :class:`.Paper` at that slice-coordinate.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError : DataCollection has not been sliced.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;DataCollection has not been sliced.&quot;</span><span class="p">))</span>
        
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">dist</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_by_i</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">indices</span><span class="p">)))</span>
            
        <span class="k">return</span> <span class="n">dist</span>
            </div>
<div class="viewcode-block" id="DataCollection.distribution_2d"><a class="viewcode-back" href="../../tethne.html#tethne.data.DataCollection.distribution_2d">[docs]</a>    <span class="k">def</span> <span class="nf">distribution_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Numpy array describing the number of :class:`.Paper`</span>
<span class="sd">        associated with each slice-coordinate, for x and y axes spcified.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist : Numpy array</span>
<span class="sd">            A 2-dimensional array. Values are the number of</span>
<span class="sd">            :class:`.Paper` at that slice-coordinate.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError : DataCollection has not been sliced.</span>
<span class="sd">        KeyError: Invalid slice axes for this DataCollection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;DataCollection has not been sliced.&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x_axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">y_axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Invalid slice axes for this DataCollection.&quot;</span><span class="p">))</span>
        
        <span class="n">x_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">x_axis</span><span class="p">])</span>
        <span class="n">y_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">y_axis</span><span class="p">])</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">x_size</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">y_size</span><span class="p">):</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_by_i</span><span class="p">([(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">i</span><span class="p">),(</span><span class="n">y_axis</span><span class="p">,</span> <span class="n">j</span><span class="p">)]))</span>
        
        <span class="k">return</span> <span class="n">dist</span>
</div></div>
<div class="viewcode-block" id="GraphCollection"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection">[docs]</a><span class="k">class</span> <span class="nc">GraphCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of NetworkX :class:`nx.classes.graph.Graph` objects, </span>
<span class="sd">    organized by some index (e.g. time). </span>
<span class="sd">    </span>
<span class="sd">    A :class:`.GraphCollection` can be generated using classes in the</span>
<span class="sd">    :mod:`tethne.builders` module. See </span>
<span class="sd">    :ref:`generate-graphcollection` for details.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The value param can be either a Graph, or a (Graph, metadata) tuple.</span>
<span class="sd">        Metadata can be anything, but is probably most profitably a dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index</span>
<span class="sd">            This can be anything used to refer to the graph.</span>
<span class="sd">        graph : :class:`.nx.classes.graph.Graph`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError : Graph must be of type networkx.classes.graph.Graph</span>
<span class="sd">            If value is not a Graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">nx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Graph must be type networkx.classes.graph.Graph&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">)</span>

<div class="viewcode-block" id="GraphCollection.nodes"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection.nodes">[docs]</a>    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return complete set of nodes for this :class:`.GraphCollection` . </span>

<span class="sd">        If this method has been called previously for this</span>
<span class="sd">        :class:`.GraphCollection` then will not recompute unless overwrite =</span>
<span class="sd">        True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        overwrite : bool</span>
<span class="sd">            If True, will generate new node list, even if one already exists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            List (complete set) of node identifiers for this</span>
<span class="sd">            :class:`.GraphCollection` .</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_list</span>
</div>
<div class="viewcode-block" id="GraphCollection.edges"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection.edges">[docs]</a>    <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>   <span class="c"># [#61512528]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return complete set of edges for this :class:`.GraphCollection` . </span>

<span class="sd">        If this method has been called previously for this</span>
<span class="sd">        :class:`.GraphCollection` then will not recompute unless overwrite =</span>
<span class="sd">        True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        overwrite : bool</span>
<span class="sd">            If True, will generate new node list, even if one already exists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        edges : list</span>
<span class="sd">            List (complete set) of edges for this :class:`.GraphCollection` .</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">overwrite</span> <span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span>
</div>
<div class="viewcode-block" id="GraphCollection.save"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filepath</span><span class="p">):</span>   <span class="c">#[61512528]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pickles (serializes) the :class:`.GraphCollection` .</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath :</span>
<span class="sd">            Full path of output file.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        PicklingError : Raised when unpicklable objects are Pickled.</span>
<span class="sd">        IOError : File does not exist, or cannot be opened.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c"># Try block if the filename is present or not.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pk</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">PicklingError</span><span class="p">:</span>     <span class="c"># Handle the Prickling error.</span>
                    <span class="k">raise</span> <span class="n">PicklingError</span> \
                            <span class="p">(</span><span class="s">&quot;Pickling error: The object cannot be pickled&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="c"># File does not exist, or couldn&#39;t be read.</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;File does not exist, or cannot be opened.&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GraphCollection.load"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>    <span class="c">#[61512528]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a pickled (serialized) :class:`.GraphCollection` from filepath.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : string</span>
<span class="sd">            Full path to pickled :class:`.GraphCollection` .</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        UnpicklingError : Raised when there is some issue in unpickling.</span>
<span class="sd">        IOError : File does not exist, or cannot be read.</span>
<span class="sd">        &quot;&quot;&quot;</span>

         <span class="c"># Handle NameError File not found.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">:</span> <span class="c">#reading in binary mode</span>
                <span class="k">try</span><span class="p">:</span>
                     <span class="n">obj_read</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UnpicklingError</span><span class="p">:</span>  <span class="c"># Handle unprickling error.</span>
                    <span class="k">raise</span> <span class="n">UnpicklingError</span> \
                        <span class="p">(</span><span class="s">&quot;UnPickling error: The object cannot be found&quot;</span><span class="p">)</span>


        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="c"># File does not exist, or couldn&#39;t be read.</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;File does not exist, or cannot be read.&quot;</span><span class="p">)</span>
        
        <span class="c"># Preserving the object with unpickled data</span>
        <span class="k">if</span><span class="p">(</span><span class="n">obj_read</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">obj_read</span><span class="o">.</span><span class="n">__dict__</span>

        <span class="k">return</span> <span class="n">obj_read</span>
        </div>
<div class="viewcode-block" id="GraphCollection.compose"><a class="viewcode-back" href="../../tethne.html#tethne.data.GraphCollection.compose">[docs]</a>    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the simple union of all :class:`.Graph` in the </span>
<span class="sd">        :class:`.GraphCollection` .</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        composed : :class:`.Graph`</span>
<span class="sd">            Simple union of all :class:`.Graph` in the </span>
<span class="sd">            :class:`.GraphCollection` .</span>
<span class="sd">            </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        </span>
<span class="sd">        Node or edge attributes that vary over slices should be ignored.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">composed</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">composed</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">composed</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">composed</span>
</div></div>
<div class="viewcode-block" id="LDAModel"><a class="viewcode-back" href="../../tethne.html#tethne.data.LDAModel">[docs]</a><span class="k">class</span> <span class="nc">LDAModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Organizes parsed output from MALLET&#39;s LDA modeling algorithm.</span>
<span class="sd">    </span>
<span class="sd">    Used by :mod:`.readers.mallet`\.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_topic</span><span class="p">,</span> <span class="n">top_word</span><span class="p">,</span> <span class="n">top_keys</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the :class:`.LDAModel`\.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc_top : Numpy matrix</span>
<span class="sd">            Rows are documents, columns are topics. Values indicate the </span>
<span class="sd">            contribution of a topic to a document, such that all rows sum to </span>
<span class="sd">            1.0.</span>
<span class="sd">        top_word : Numpy matrix</span>
<span class="sd">            Rows are topics, columns are words. Values indicate the normalized</span>
<span class="sd">            contribution of each word to a topic, such that rows sum to 1.0.</span>
<span class="sd">        top_keys : dict</span>
<span class="sd">            Maps matrix indices for topics onto the top words in that topic.</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Maps matrix indices for documents onto a :class:`.Paper` key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_topic</span> <span class="o">=</span> <span class="n">doc_topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_word</span> <span class="o">=</span> <span class="n">top_word</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_keys</span> <span class="o">=</span> <span class="n">top_keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span> <span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">}</span>
        
<div class="viewcode-block" id="LDAModel.topics_in_doc"><a class="viewcode-back" href="../../tethne.html#tethne.data.LDAModel.topics_in_doc">[docs]</a>    <span class="k">def</span> <span class="nf">topics_in_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">topZ</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the topZ most prominent topics in a document.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : str or int</span>
<span class="sd">            An identifier from a :class:`.Paper` key.</span>
<span class="sd">        topZ : int or float</span>
<span class="sd">            Number of prominent topics to return (int), or threshold (float).</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        topics : list</span>
<span class="sd">            List of (topic, proportion) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_topic</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="k">if</span> <span class="n">topZ</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">topZ</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">topZ</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>   <span class="c"># Return a set number of topics.</span>
            <span class="n">top_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">td</span><span class="p">)[</span><span class="n">topZ</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">topZ</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>   <span class="c"># Return topics above a threshold.</span>
            <span class="n">top_indices</span> <span class="o">=</span> <span class="p">[</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">td</span><span class="p">)</span> <span class="k">if</span> <span class="n">td</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">topZ</span> <span class="p">]</span>

        <span class="n">top_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">td</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">top_indices</span> <span class="p">]</span>
        
        <span class="n">topics</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">top_indices</span><span class="p">,</span> <span class="n">top_values</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">topics</span>
        </div>
<div class="viewcode-block" id="LDAModel.docs_in_topic"><a class="viewcode-back" href="../../tethne.html#tethne.data.LDAModel.docs_in_topic">[docs]</a>    <span class="k">def</span> <span class="nf">docs_in_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">topD</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the topD documents most representative of topic z.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z : int</span>
<span class="sd">            A topic index.</span>
<span class="sd">        topD : int or float</span>
<span class="sd">            Number of prominent topics to return (int), or threshold (float).</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        documents : list</span>
<span class="sd">            List of (document, proportion) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_topic</span><span class="p">[:,</span> <span class="n">z</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">topD</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">topD</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">topD</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>   <span class="c"># Return a set number of documents.</span>
            <span class="n">top_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">td</span><span class="p">)[</span><span class="n">topD</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">topD</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>   <span class="c"># Return documents above a threshold.</span>
            <span class="n">top_indices</span> <span class="o">=</span> <span class="p">[</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">td</span><span class="p">)</span> <span class="k">if</span> <span class="n">td</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">topD</span> <span class="p">]</span>
        
        <span class="n">top_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">td</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">top_indices</span> <span class="p">]</span>
        <span class="n">top_idents</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">top_indices</span> <span class="p">]</span>
        
        <span class="n">documents</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">top_idents</span><span class="p">,</span> <span class="n">top_values</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">documents</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">tethne 0.3.1-alpha documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, ASU Digital Innovation Group.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>